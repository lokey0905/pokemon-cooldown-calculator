<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è¼¸å…¥å…©é»åº§æ¨™æˆ–è·é›¢å³å¯è¨ˆç®—å‡ºéœ€è¦ç­‰å¾…çš„å†·å»æ™‚é–“ï¼Œé©ç”¨æ–¼PokÃ©mon GO å¯¶å¯å¤¢,Monster Hunter Now é­”ç‰©çµäºº nowç­‰ç­‰ï½œlokey0905">
    <title>è·é›¢å†·å»æ™‚é–“è¨ˆç®—æ©Ÿ è¼¸å…¥å…©é»åº§æ¨™æˆ–è·é›¢å³å¯è¨ˆç®—å‡ºéœ€è¦ç­‰å¾…çš„å†·å»æ™‚é–“ï½œlokey0905</title>
    <base href="https://cool.android.ovh/">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>

<script src="./bundle.js"></script>

<script>
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
      alert("æ­¤è¨­å‚™ä¸æ”¯æ´å®šä½æœå‹™");
    }
  }
  
  function showPosition(position) {
    var latlon = position.coords.latitude + "," + position.coords.longitude;
    if(confirm("è¨­å‚™åº§æ¨™:"+latlon+"\næŒ‰ã€Œç¢ºå®šã€:å¡«å…¥åº§æ¨™1\næŒ‰ã€Œå–æ¶ˆã€:å¡«å…¥åº§æ¨™2") == true){
      document.getElementById("input1").value = latlon;
    } else {
      document.getElementById("input2").value = latlon;
    }
  }
  
  function showError(error) {
    switch(error.code) {
      case error.PERMISSION_DENIED:
        alert("ä½¿ç”¨è€…æ‹’çµ•æä¾›ä½ç½®è³‡è¨Š");
        break;
      case error.POSITION_UNAVAILABLE:
        alert("ç„¡æ³•å–å¾—ä½ç½®è³‡è¨Š");
        break;
      case error.TIMEOUT:
        alert("å–å¾—ä½ç½®è³‡è¨Šé€¾æ™‚");
        break;
      case error.UNKNOWN_ERROR:
        alert("ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤");
        break;
    }
  }

  function clean() {
    document.getElementById("input1").value="";
    document.getElementById("input2").value="";
    document.getElementById("inputkm").value="";
    document.getElementById("cooldown").textContent="";
    document.getElementById("realtime").textContent="";
  }

  function ok() {
    const input1 = document.getElementById("input1").value;
    const input2 = document.getElementById("input2").value;
    const inputKm = document.getElementById("inputkm");

    if (input1 && input2) {
      const [lat1, lon1] = input1.split(",").map(parseFloat);
      const [lat2, lon2] = input2.split(",").map(parseFloat);
      const distance = calculateDistance(lat1, lon1, lat2, lon2);
      inputKm.value = distance.toFixed(3);
      
      updateResults(distance);
    } else if (inputKm.value) {
      const distance = parseFloat(inputKm.value);
      updateResults(distance);
    } else {
      alert("è«‹è¼¸å…¥åº§æ¨™æˆ–è·é›¢");
    }
  }

  // æ›´æ–°é¡¯ç¤ºçµæœçš„å°è£å‡½æ•¸
  function updateResults(distance) {
    const cooldownTime = calculateCooldownTime(distance);
    const realTime = calculateRealTravelTime(distance);
    
    document.getElementById("cooldown").textContent = `ğŸ® éŠæˆ²å†·å»: ${cooldownTime}`;
    document.getElementById("realtime").textContent = `ğŸš¶ çœŸå¯¦ç§»å‹•: ${realTime}`;
  }

  function calculateDistance(lat1, lon1, lat2, lon2) {
    const earthRadiusKm = 6371;
    const lat1Rad = toRadians(lat1);
    const lon1Rad = toRadians(lon1);
    const lat2Rad = toRadians(lat2);
    const lon2Rad = toRadians(lon2);

    const dLat = lat2Rad - lat1Rad;
    const dLon = lon2Rad - lon1Rad;
    const a =
      Math.sin(dLat / 2) ** 2 +
      Math.cos(lat1Rad) * Math.cos(lat2Rad) * Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return earthRadiusKm * c;
  }

  function toRadians(degrees) {
    return degrees * (Math.PI / 180);
  }

  // 1. éŠæˆ²å†·å»æ™‚é–“é‚è¼¯ (åŒæ­¥æ–æ¡¿ App ç®—æ³•)
  function calculateCooldownTime(distance) {
    distance = Math.abs(distance);
    if (distance < 0.01) return "0 ç§’";
    if (distance < 0.1)  return "3 ç§’";
    if (distance < 0.5)  return "15 ç§’";
    if (distance < 1)    return "30 ç§’";
    if (distance < 5)    return "2 åˆ†é˜";
    if (distance < 10)   return "6 åˆ†é˜";
    if (distance < 25)   return "11 åˆ†é˜";
    if (distance < 30)   return "14 åˆ†é˜";
    if (distance < 65)   return "22 åˆ†é˜";
    if (distance < 81)   return "25 åˆ†é˜";
    if (distance < 100)  return "35 åˆ†é˜";
    if (distance < 250)  return "45 åˆ†é˜";
    if (distance < 500)  return "60 åˆ†é˜ (1 å°æ™‚)";
    if (distance < 750)  return "75 åˆ†é˜ (1 å°æ™‚ 15 åˆ†)";
    if (distance < 1000) return "90 åˆ†é˜ (1 å°æ™‚ 30 åˆ†)";
    return "120 åˆ†é˜ (2 å°æ™‚)"; // ä¸Šé™
  }

  // 2. çœŸå¯¦ç§»å‹•ä¼°ç®—é‚è¼¯
  function calculateRealTravelTime(distance) {
    distance = Math.abs(distance);
    if (distance <= 0) return "å·²ç¶“æŠµé”";

    // åŠ å…¥ 1.3 å€çš„é“è·¯æ›²æŠ˜ä¿‚æ•¸ï¼Œå°‡ç›´ç·šè·é›¢æ›ç®—æˆç´„ç•¥çš„å¯¦éš›é“è·¯è·é›¢
    const roadDistance = distance * 1.3;

    if (distance < 2) {
      // < 2å…¬é‡Œï¼šæ­¥è¡Œ (å‡è¨­æ™‚é€Ÿ 5 km/h -> æ¯å…¬é‡Œ 12 åˆ†é˜)
      const mins = Math.round(roadDistance * 12);
      return `ç´„ ${mins} åˆ†é˜ (æ­¥è¡Œ)`;
    } else if (distance < 50) {
      // 2~50å…¬é‡Œï¼šå¸‚å€/éƒŠå€é–‹è»Š (å‡è¨­æ™‚é€Ÿ 40 km/h -> æ¯å…¬é‡Œ 1.5 åˆ†é˜)
      const mins = Math.round(roadDistance * 1.5);
      const hours = Math.floor(mins / 60);
      const remainMins = mins % 60;
      return hours > 0 ? `ç´„ ${hours} å°æ™‚ ${remainMins} åˆ†é˜ (é–‹è»Š)` : `ç´„ ${mins} åˆ†é˜ (é–‹è»Š)`;
    } else if (distance < 500) {
      // 50~500å…¬é‡Œï¼šé«˜é€Ÿå…¬è·¯é–‹è»Š (å‡è¨­æ™‚é€Ÿ 90 km/h -> æ¯å…¬é‡Œ 0.67 åˆ†é˜)
      // é«˜é€Ÿå…¬è·¯é€šå¸¸æ¯”è¼ƒç›´ï¼Œæ›²æŠ˜ä¿‚æ•¸é™ç‚º 1.15
      const highwayDistance = distance * 1.15;
      const mins = Math.round(highwayDistance * 0.67);
      const hours = Math.floor(mins / 60);
      const remainMins = mins % 60;
      return `ç´„ ${hours} å°æ™‚ ${remainMins} åˆ†é˜ (é–‹è»Š)`;
    } else {
      // > 500å…¬é‡Œï¼šæ­ä¹˜é£›æ©Ÿ (å‡è¨­æ™‚é€Ÿ 800 km/h) + 2å°æ™‚æ©Ÿå ´å ±åˆ°å®‰æª¢æ™‚é–“
      const flightHours = (distance / 800) + 2;
      const hours = Math.floor(flightHours);
      const mins = Math.round((flightHours - hours) * 60);
      return `ç´„ ${hours} å°æ™‚ ${mins} åˆ†é˜ (æ­æ©Ÿé£›è¡Œ)`;
    }
  }
</script>

<body>
  <div class="container">
    <div>
      <label for="input1"><font>åº§æ¨™1</font></label>
      <md-outlined-text-field label="è¼¸å…¥: xx.xx, yy.yy" id="input1"></md-outlined-text-field>
    </div>
    <br>
    <div>
      <label for="input2"><font>åº§æ¨™2</font></label>
      <md-outlined-text-field label="è¼¸å…¥: xx.xx, yy.yy" id="input2"></md-outlined-text-field>
    </div>
    <br>
    <div>
      <label for="inputkm"><font>è·é›¢:</font></label>
      <md-outlined-text-field type="number" label="è¼¸å…¥:æ•¸å­—(å–®ä½:km)" id="inputkm"></md-outlined-text-field>
    </div>
    <br>
    <div>
      <md-filled-tonal-button class="full-button" onclick="getLocation()">
        å–å¾—è£ç½®ä½ç½®
        <svg slot="icon" viewBox="0 -960 960 960"><path d="M480-80Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q17 0 32.5 1.5T544-874v62q-15-4-31-6t-33-2q-109.417 0-184.708 75.105Q220-669.79 220-552q0 75 65 173.5T480-159q133-121 196.5-219.5T740-552q0-8-.5-16t-1.5-16h61q1 8 1 16v16q0 100-79.5 217.5T480-80Zm.089-410Q509-490 529.5-510.589q20.5-20.588 20.5-49.5Q550-589 529.411-609.5q-20.588-20.5-49.5-20.5Q451-630 430.5-609.411q-20.5 20.588-20.5 49.5Q410-531 430.589-510.5q20.588 20.5 49.5 20.5ZM480-560Zm252-84h60v-128h128v-60H792v-128h-60v128H604v60h128v128Z"/></svg>
      </md-filled-tonal-button>
    </div>
    <br>
    <div class="half-div">
      <md-filled-button id="ok" onclick="ok()">è¨ˆç®—</md-filled-button>
      <md-outlined-button id="clean" onclick="clean()">æ¸…é™¤</md-outlined-button>
    </div>
    
    <h2 id="cooldown" style="color: #d32f2f; margin-top: 20px;"></h2>
    <h3 id="realtime" style="color: #1976d2; margin-top: 10px;"></h3>
  </div>
</body>
</html>
